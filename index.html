<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Route Finder - Texas Tech University - Lubbock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://www.ttu.edu/_ttu-template/2017/img/favicon.ico" type="image/x-icon" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="assets/css/main.css" />

    <style>
   

      /* #answer-box {
        border: 1px solid black;
        padding: 10px;
        margin-top: 10px;
      } */
    </style>
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-light bg-light fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand d-flex justify-content-center w-100" href="#">
          <img
            src="/assets/images/citi_bus_logo.svg"
            class="d-inline-block align-text-top"
          />
          <span class="main-title">Route Finder</span>
        </a>
      </div>
    </nav>
    <!-- Header -->

    <!-- Carousel -->
    <div
      id="carouselCitiBus"
      class="carousel slide carousel-fade"
      data-bs-ride="carousel"
    >
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img
            src="/assets/images/carousel/1.avif"
            class="d-block w-100"
            alt="Citi Bus Image"
          />
        </div>
        <div class="carousel-item">
          <img
            src="/assets/images/carousel/2.jpeg"
            class="d-block w-100"
            alt="Citi Bus Image"
          />
        </div>
        <div class="carousel-item">
          <img
            src="/assets/images/carousel/3.avif"
            class="d-block w-100"
            alt="Citi Bus Image"
          />
        </div>
      </div>
    </div>
    <!-- Carousel -->

    <!-- Question Input -->
    <div class="search-container container mt-5 mb-5">
      <h1 class="text-center text-primary fw-bold">Ask a Question</h1>
        <p id="answer" class="new_txt"></p>
        <p id="answer-box" class="new_txt"></p>
        <div>
          <form>
            <input
              hidden
              type="range"
              min="0.5"
              max="2"
              value="1"
              step="0.1"
              id="rate"
              class="txt"
            />
        </form>
        <div class="clearfix"></div>
      </div>
      <div>
        <input
          hidden
          type="range"
          min="0"
          max="2"
          value="1"
          step="0.1"
          id="pitch"
        />
      </div>
      <select disabled></select>

       <form>
        <p class="input-container">
          <div class="voice-text d-flex">
            <button id="voice-input-btn">
            <i class="fa fa-microphone"></i>
          </button>
        
            <input type="text" id="text-input" class="query-input" autocomplete="off" /> 
          
          <label for="text-input" unselectable="on"> QUESTION </label>
          </div>
          
        </p> 
      </form>
       <div class="button-container">
          <button class="btn" id="submit-btn">SEARCH</button>
       </div>
  </div>

    <div class="input-container">
      
    
      <!-- <button id="voice-input-btn"><i class="fa fa-microphone"></i></button> -->
      <!-- <input type="text" id="text-input" placeholder="Type your question..." /> -->
      <!-- <button id="submit-btn">Submit</button> -->
    </div>
    <!-- Question Input -->

    <!-- Service Hours -->
    <div class="container bg-light mb-5">
      <div class="jumbotron p-4">
        <h1 class="fw-bold text-primary mb-5 text-center">Service Hours</h1>
        <div class="row">
          <div class="col">
            <h3 class="service-heading fs-4 fw-bold mb-4">Span of Service:</h3>
            <div class="service-content">
              <p class="fw-bold fs-4">Weekdays</p>
              <p class="fw-bold fs-4">Saturdays</p>
              <p class="fw-bold fs-4">Sundays</p>
            </div>
          </div>

          <div class="col">
            <h3 class="service-heading fs-4 fw-bold mb-4">Fixed Route</h3>
            <div class="service-content">
              <p class="fs-4">5:35 AM - 7:45 PM</p>
              <p class="fs-4">6:35 AM - 7:55 PM</p>
              <p class="fs-4">N/A</p>
            </div>
          </div>

          <div class="col">
            <h3 class="service-heading fs-4 fw-bold mb-4">Demand Response</h3>
            <div class="service-content">
              <p class="fs-4">7:00 AM - 11:00 PM</p>
              <p class="fs-4">6:45 AM - 11:00 PM</p>
              <p class="fs-4">N/A</p>
            </div>
          </div>

          <div class="col">
            <h3 class="service-heading fs-4 fw-bold mb-4">
              Others(Paratransit)
            </h3>
            <div class="service-content">
              <p class="fs-4">5:35 AM - 7:45 PM</p>
              <p class="fs-4">6: 35 AM - 7:55 PM</p>
              <p class="fs-4">N/A</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Service Hours -->

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <p> Citibus Â© Copyright 2023. All rights reserved.  </p>
          </div>
          <div class="col-md-8 right">
            <div class="contact">
              <p><i class="fa fa-phone"></i> &nbsp; 806-775-3640</p>
              <p><i class="fa fa-map-marker"></i> &nbsp; 801 Texas Ave. | Lubbock, Texas 79401</p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="//www.aa.com/jquery.js"></script>

    <script src="fuzzyset.js"></script>

    <script>
      var isClose = true;
      const stopwords = [
        'of',
        'the',
        'a',
        'an',
        'any',
        'is',
        'can',
        'who',
        'what',
        'why',
        'whom',
      ];
      // var editor =
      //   'sorts\n' +
      //   '    #people = {tommy, alex, john, daniel, sarah, peter, lino}.\n' +
      //   '    #gender = {male, female}.\n' +
      //   'predicates\n' +
      //   '    advisor(#people, #people).\n' +
      //   '    friend(#people, #people).\n' +
      //   '    gender(#people,#gender).\n' +
      //   '    spanish(#people).\n' +
      //   'rules\n' +
      //   '    advisor(tommy, alex).\n' +
      //   '    advisor(tommy, john).\n' +
      //   '    advisor(tommy, daniel).\n' +
      //   '    advisor(tommy, lino).\n' +
      //   '    friend(lino, alex).\n' +
      //   '    friend(lino, peter).\n' +
      //   '    friend(sarah, alex).\n' +
      //   '    friend(X, Y):-friend(Y,X).\n' +
      //   '    gender(tommy,male).\n' +
      //   '    gender(lino,male).\n' +
      //   '    gender(sarah, female).\n' +
      //   '    spanish(lino).';

      // var editor =
      // 'sorts\n' +
      // '   #people = {john, bill, jim, joan, sam}.' +
      // 'predicates\n' +
      // '   father(#people, #people).' +
      // '   mother(#people, #people).' +
      // '   dad(#people, #people).' +
      // '   parent(#people, #people).' +
      // 'rules\n' +
      // '   father(john, bill).' +
      // '   mother(joan, bill). ' +
      // '   mother(joan, sam). ' +
      // '   dad(X, Y) :-  father(X, Y).' +
      // '   parent(X, Y) :- father(X, Y).' +
      // '   parent(X, Y) :- mother(X, Y).';
      // var editor =
      //   'sorts\n' +
      //   '   #professor = {jingjing_yao, micheal_shin, tommy_dang, susan_mengel, yuanlin_zhang, bashir_morshed, lu_wei, lin_chen, sunho_lim}.\n' +
      //   '   #course_code = {cs5120, cs5341, cs5352, cs5363, cs5364, cs5368, cs5373, cs5374, cs5375, cs5381, cs5383, cs5384, cs5386, cs5392}.\n' +
      //   '   #course_title = {computer_science_graduate_seminar, pattern_recognition, advanced_operating_system_design, software_project_management, information_retrieval, intelligent_system, software_modeling_and_architecture, software_verification_and_validation, computer_system_organization_and_architecture, analysis_of_algorithm, theory_of_automata, logic_for_computer_scientists, wireless_networking_and_mobile_computing, reinforcement_learning}.\n' +
      //   '   #student = {akankshya_rajput, raj_dhaubanjar, sumit_shrestha}.\n' +
      //   'predicates\n' +
      //   '   course(#course_code, #course_title).\n' +
      //   '   instructor(#professor, #course_code).\n' +
      //   '   instructor_of(#professor, #student).\n' +
      //   '   same_course(#professor, #course_code).\n' +
      //   '   course_code_professor(#professor, #course_title).\n' +
      //   'rules\n' +
      //   '   course(cs5120, computer_science_graduate_seminar).\n' +
      //   '   instructor(jingjing_yao, cs5120).\n' +
      //   '   course(cs5341, pattern_recognition).\n' +
      //   '   instructor(micheal_shin, cs5341).\n' +
      //   '   course(cs5352, advanced_operating_system_design).\n' +
      //   '   instructor(tommy_dang, cs5352).\n' +
      //   '   course(cs5352, advanced_operating_system_design).\n' +
      //   '   instructor(tommy_dang, cs5352).\n' +
      //   '   course(cs5352, advanced_operating_system_design).\n' +
      //   '   instructor(tommy_dang, cs5352).\n' +
      //   '   course(cs5363, software_project_management).\n' +
      //   '   instructor(micheal_shin, cs5363).\n' +
      //   '   course(cs5364, information_retrieval).\n' +
      //   '   instructor(micheal_shin, cs5364).\n' +
      //   '   course(cs5368, intelligent_system).\n' +
      //   '   instructor(yuanlin_zhang, cs5368).\n' +
      //   '   course(cs5373, software_modeling_and_architecture).\n' +
      //   '   instructor(micheal_shin, cs5373).\n' +
      //   '   course(cs5374, software_verification_and_validation).' +
      //   '   instructor(micheal_shin, cs5374).\n' +
      //   '   course(cs5375, computer_system_organization_and_architecture).\n' +
      //   '   instructor(bashir_morshed, cs5375).\n' +
      //   '   course(cs5381, analysis_of_algorithm).\n' +
      //   '   instructor(lu_wei, cs5381).\n' +
      //   '   course(cs5383, theory_of_automata).\n' +
      //   '   instructor(lin_chen, cs5383).\n' +
      //   '   course(cs5384, logic_for_computer_scientists).\n' +
      //   '   instructor(yuanlin_zhang, cs5384).\n' +
      //   '   course(cs5386, wireless_networking_and_mobile_computing).\n' +
      //   '   instructor(sunho_lim, cs5386).\n' +
      //   '   course(cs5392, reinforcement_learning).\n' +
      //   '   instructor(susan_mengel, cs5392).';

      var editor = 
      'sorts\n' +
        '#location = {college_of_business_administration, the_republic, the_holly, indiana_village, international_cultural_center, holden_hall, student_union_building, university_library, student_recreation_center, student_wellness_center}.\n'+
        '#route_number = {41, 42, 48}.\n'+
        '#bus_map = {college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center, college_of_business_administration___holden_hall___student_union_building___university_library___student_recreation_center___student_wellness_center, college_of_business_administration___student_wellness_center___student_recreation_center___university_library___student_union_building___holden_hall}.\n'+

      'predicates\n' +
          'route(#route_number, #location).\n'+
          
          'same_route(#location, #location).\n'+
          
          'neighbouring_route(#location, #location).\n'+
          
          'previous_route(#location, #location).\n'+
          
          'next_route(#location, #location).\n'+

          'center_point_route(#location).\n'+
          
          'starting_route(#route_number, #location).\n'+
          
          'ending_route(#route_number, #location).\n'+
          
          'fastest_route(#location, #route_number, #bus_map).\n'+
          
          'bus_route(#route_number, #bus_map).\n'+

      'rules\n'+
          
          'route(48, college_of_business_administration).\n'+
          'route(48, the_republic).\n'+
          'route(48, the_holly).\n'+
          'route(48, indiana_village).\n'+
          'route(48, international_cultural_center).\n'+
          
          'route(42, college_of_business_administration).\n'+
          'route(42, holden_hall).\n'+
          'route(42, student_union_building).\n'+
          'route(42, university_library).\n'+
          'route(42, student_recreation_center).\n'+
          'route(42, student_wellness_center).\n'+
          
          'route(41, college_of_business_administration).\n'+
          'route(41, student_wellness_center).\n'+
          'route(41, student_recreation_center).\n'+
          'route(41, university_library).\n'+
          'route(41, student_union_building).\n'+
          'route(41, holden_hall).\n'+

          'center_point_route(college_of_business_administration).\n'+
          
          'starting_route(41, college_of_business_administration).\n'+
          'starting_route(42, college_of_business_administration).\n'+
          'starting_route(48, college_of_business_administration).\n'+
          
          'ending_route(41, holden_hall).\n'+
          'ending_route(42, student_wellness_center).\n'+
          'ending_route(48, international_cultural_center).\n'+
          
          'previous_route(college_of_business_administration, international_cultural_center).\n'+
          'previous_route(international_cultural_center, indiana_village).\n'+
          'previous_route(indiana_village, the_holly).\n'+
          'previous_route(the_holly, the_republic).\n'+
          'previous_route(the_republic, college_of_business_administration).\n'+
          
          'previous_route(college_of_business_administration, student_wellness_center).\n'+
          'previous_route(student_wellness_center, student_recreation_center).\n'+
          'previous_route(student_recreation_center, university_library).\n'+
          'previous_route(university_library, student_union_building).\n'+
          'previous_route(student_union_building, holden_hall).\n'+
          'previous_route(holden_hall, college_of_business_administration).\n'+
          
          'previous_route(college_of_business_administration, holden_hall).\n'+
          'previous_route(holden_hall, student_union_building).\n'+
          'previous_route(student_union_building, university_library).\n'+
          'previous_route(university_library, student_recreation_center).\n'+
          'previous_route(student_recreation_center, student_wellness_center).\n'+
          'previous_route(student_wellness_center, college_of_business_administration).\n'+
          
          
          'next_route(college_of_business_administration, the_republic).\n'+
          'next_route(the_republic, the_holly).\n'+
          'next_route(the_holly, indiana_village).\n'+
          'next_route(indiana_village, international_cultural_center).\n'+
          'next_route(international_cultural_center, college_of_business_administration).\n'+
          
          'next_route(college_of_business_administration, holden_hall).\n'+
          'next_route(holden_hall, student_union_building).\n'+
          'next_route(student_union_building, university_library).\n'+
          'next_route(university_library, student_recreation_center).\n'+
          'next_route(student_recreation_center, student_wellness_center).\n'+
          'next_route(student_wellness_center, college_of_business_administration).\n'+
          
          'next_route(college_of_business_administration, student_wellness_center).\n'+
          'next_route(student_wellness_center, student_recreation_center).\n'+
          'next_route(student_recreation_center, university_library).\n'+
          'next_route(university_library, student_union_building).\n'+
          'next_route(student_union_building, holden_hall).\n'+
          'next_route(holden_hall, college_of_business_administration).\n'+
          
          'bus_route(41, college_of_business_administration___student_wellness_center___student_recreation_center___university_library___student_union_building___holden_hall).\n'+
          'bus_route(42, college_of_business_administration___holden_hall___student_union_building___university_library___student_recreation_center___student_wellness_center).\n'+
          'bus_route(48, college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center).\n'+
          
          'fastest_route(the_republic, 48, college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center).\n'+
          'fastest_route(the_holly, 48, college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center).\n'+
          'fastest_route(indiana_village, 48, college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center).\n'+
          'fastest_route(international_cultural_center, 48, college_of_business_administration___the_republic___the_holly___indiana_village___international_cultural_center).\n'+
          'fastest_route(holden_hall, 42, college_of_business_administration___holden_hall___student_union_building___university_library___student_recreation_center___student_wellness_center).\n'+
          'fastest_route(student_union_building, 42, college_of_business_administration___holden_hall___student_union_building___university_library___student_recreation_center___student_wellness_center).\n'+
          'fastest_route(university_library, 42, college_of_business_administration___holden_hall___student_union_building___university_library___student_recreation_center___student_wellness_center).\n'+
          'fastest_route(university_library, 41, college_of_business_administration___student_wellness_center___student_recreation_center___university_library___student_union_building___holden_hall).\n'+
          'fastest_route(student_recreation_center, 41, college_of_business_administration___student_wellness_center___student_recreation_center___university_library___student_union_building___holden_hall).\n'+
          'fastest_route(student_wellness_center, 41, college_of_business_administration___student_wellness_center___student_recreation_center___university_library___student_union_building___holden_hall).\n'+
          
          '-same_route(X,Y) :- not same_route(X,Y).\n'+
          
          'same_route(X,Y) :- route(Z, X), route(Z, Y), X != Y.\n'+
          
          'next_route(X,Y) :- next_route(X, Y).\n'+
          
          '-next_route(X,Y) :- not next_route(X, Y).\n'+
          
          'neighbouring_route(X, Y) :- next_route(X, Y).\n'+
          
          'neighbouring_route(X, Y) :- previous_route(Y, X).\n'+
          
          '-neighbouring_route(X, Y) :- not next_route(X, Y).\n'+
          
          '-neighbouring_route(X, Y) :- not previous_route(Y, X).';

      // sorts
      var contstring = editor.split('sorts\n')[1].split('predicates\n');
      var sortstring = contstring[0].split('.');
      sortstring.splice(-1, 1);
      var sorts = {};
      sortstring = sortstring
        .map((d) => d.replace(/\n/g, '').trim())
        .forEach((d) => {
          var par = d.split('=');
          sorts[par[0].replace(/#/, '').trim()] = par[1]
            .replace(/{|}/g, '')
            .split(',')
            .map((w) => w.trim());
        });
      // predicates
      var predicates = {};
      contstring = contstring[1].split('rules\n');
      sortstring = contstring[0].split('.');
      sortstring.splice(-1, 1);
      sortstring.forEach((d) => {
        var part = d.replace(/\n/g, '').trim().split('(');
        var func = part[0];
        predicates[func] = {};
        var par = part[1].split(',').map((e) => e.replace(/#|\)/g, '').trim());
        var par1 = sorts[par[0]].slice();
        par1.push('X');
        par.splice(0, 1);
        par1.forEach((e) => {
          var strinh = (e == 'X' ? '' : e + ' ') + func;
          predicates[func][strinh] = func + '(' + e + ')';
          par.forEach((par2) => {
            var temp = sorts[par2].slice();
            temp.push('X');
            temp.forEach((t) => {
              var strinh =
                (e == 'X' ? '' : e + ' ') + func + (t == 'X' ? '' : ' ' + t);
              // if (strinh != fubnc)
              predicates[func][strinh] = func + '(' + e + ',' + t + ')';
            });
          });
        });
      });

      var all_predicates = [];
      for (var key1 in predicates) {
        if (predicates.hasOwnProperty(key1)) {
          for (var key2 in predicates[key1]) {
            if (predicates[key1].hasOwnProperty(key2))
              all_predicates.push(key2);
          }
        }
      }
      all_predicates.push('speak spanish'); // extra terms
      a = FuzzySet(all_predicates);

      console.log(all_predicates);

      // Speech recognition API
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US';

      // Get DOM elements
      const answerDiv = document.querySelector('#answer');
      const voiceBtn = document.getElementById('voice-input-btn');
      const textInput = document.getElementById('text-input');
      const submitBtn = document.getElementById('submit-btn');
      const answerBox = document.getElementById('answer-box');

      submitBtn.addEventListener('click', () => {
        const question = textInput.value;
        if (question.trim() === '') {
          answerBox.innerHTML = 'Please ask a question.';
          return;
        }
        var trim_script = question.split(' ');
        trim_script = trim_script.filter((f) => !stopwords.includes(f));
        var queryQues = a.get(trim_script.join(' '), null, 0.5);
        getAnswer(queryQues);
      });

      // Handle speech recognition
      recognition.onresult = (event) => {
        const resultIndex = event.resultIndex;
        const transcript = event.results[resultIndex][0].transcript;
        textInput.value = transcript;

        var trim_script = transcript.split(' ');
        trim_script = trim_script.filter((f) => !stopwords.includes(f));
        var queryQues = a.get(trim_script.join(' '), null, 0.5);
        console.log(queryQues);
        getAnswer(queryQues);
      };

      // Handle click on voice input button
      function startSpeechRecognition() {
        recognition.start();
      }
      voiceBtn.addEventListener('click', startSpeechRecognition);

      function getAnswer(question) {
        if (question != null) {
          var mainkey = question[0][1].replace('speak ', '');
          var answerarr = mainkey.split(' ');
          var key1 = '';
          answerarr.forEach((d) => {
            key1 = predicates[d] != undefined ? d : key1;
          });
          //var key1 = answerarr.length>2? answerarr[1]:answerarr[0];
          var key2 = mainkey;
          console.log(key1 + '-' + key2);
          console.log(predicates[key1][key2]);

          var data = {
            action: 'getQuery',
            query: predicates[key1][key2],
            editor: editor,
          };

          console.log(data);

          $.ajax({
            url: 'https://cors-anywhere.herokuapp.com/http://wave.ttu.edu/ajax.php',
            type: 'POST',
            headers: {
              'X-Requested-With': 'XMLHttpRequest',
            },
            data: {
              action: 'getQuery',
              query: predicates[key1][key2],
              editor: editor,
            },
            success: function (response) {
              console.log(response);
              const answer = response || 'Sorry, I could not find an answer.';
              answerDiv.innerHTML = answer;
              answerBox.innerHTML = answer;
            },
            error: function (xhr, status, error) {
              console.log('error: ' + error);
            },
          });

          //$.post("http://localhost/ajax.php", { url: "http://wave.ttu.edu/" , data:data}, function (response) {
          // Expected response : answer sets
          //$.post("http://localhost/ajax/ajax.js",  function (response) {
          //$.post("http://localhost/ajaxtest.php", function (response) {
          // $.post("https://cors-anywhere.herokuapp.com/http://wave.ttu.edu/", data, function (response) {

          // console.log(response);

          // var html = document.createElement("html");
          // html.innerHTML = response;
          // contentRan
          // var answerstring = html.querySelector("p").textContent.replace(/X =/gm, "");
          //  var answerarr = answerstring.split("\n");
          //  answerarr.splice(-1,1);
          //   console.log(answerarr);
          //   var pre_string = "The answer to your question " + transcript + " is ";
          //   answerstring = contentRan.answer[answerarr[0].toLowerCase().trim()]==undefined?
          //       (pre_string + (answerarr.length==1?answerstring:(answerarr.splice(-1, 0, "and"),answerarr.join())))
          //       : generaspeak(contentRan.answer[answerarr[0].toLowerCase().trim()]);
          //    console.log(answerstring);

          //   const answer = answerstring || 'Sorry, I could not find an answer.';
          //   answerDiv.innerHTML = answer;
          //   answerBox.innerHTML = answer;
          //   console.log(answer);

          // });
        }
      }
    </script>
    <script src="Test/script.js"></script>
    <script>
      var myCarousel = document.querySelector('#carouselCitiBus');
      var carousel = new bootstrap.Carousel(myCarousel, {
        interval: 7000,
      });

      $(".query-input").focus(function(){
          $(this).parent().addClass("animation animation-color");
      });

      //Remove animation(s) when input is no longer focused
      $(".query-input").focusout(function(){
        if($(this).val() === "")
          $(this).parent().removeClass("animation");
        $(this).parent().removeClass("animation-color");
      })
    </script>
  </body>
</html>
